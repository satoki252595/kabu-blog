import firebase_admin
from firebase_admin import credentials
from firebase_admin import firestore

from method.getStockInfo import getStockInfo
from method.getStocCodes import getStockCodes


# Use a service account.
cred = credentials.Certificate(
    '/Users/satoki252595/work/20230527_kabu_python/kabu-blog-18f635ac9b82.json')

app = firebase_admin.initialize_app(cred)

db = firestore.client()


def setStockPrice(code, period):

    code = str(code)

    df_stockPriceInfo = getStockInfo.getStockPriceInfo(code, period)
    for i, l in enumerate(df_stockPriceInfo.index):
        date = str(df_stockPriceInfo.index[i].date())
        priceList = df_stockPriceInfo.loc[l]

        doc_ref = db.collection(code).document(date)
        doc_ref.set({
            u'Open': priceList['Open'],
            u'High': priceList['High'],
            u'Low': priceList['Low'],
            u'Close': priceList['Close'],
            u'Volume': priceList['Volume']
        }, merge=True)


df_stockCodes = getStockCodes()
# stockCodesList = [str(l) for l in df_stockCodes['コード']]

# 無料枠を利用するため。銘柄コードが1のものを中心に取得する。
# 1,2,3は完了。

# stockCodesList = [str(l) for l in df_stockCodes['コード']
#                   if str(l).startswith('4')]

stockCodesList = ['4177', '4178', '4179', '4180', '4182', '4183', '4185', '4186', '4187', '4188', '4189', '4192', '4193', '4194', '4196', '4198', '4199', '4200', '4202', '4203', '4204', '4205', '4206', '4208', '4212', '4215', '4216', '4218', '4220', '4221', '4222', '4224', '4228', '4229', '4231', '4234', '4235', '4237', '4238', '4240', '4241', '4242', '4243', '4245', '4246', '4247', '4248', '4249', '4251', '4255', '4256', '4258', '4259', '4260', '4261', '4262', '4263', '4264', '4265', '4267', '4268', '4270', '4272', '4274', '4275', '4284', '4286', '4287', '4288', '4290', '4293', '4295', '4298', '4299', '4301', '4304', '4307', '4308', '4310', '4312', '4316', '4317', '4318', '4319', '4320', '4323', '4324', '4326', '4327', '4331', '4333', '4334', '4335', '4337', '4341', '4343', '4344', '4345', '4346', '4347', '4348', '4350', '4351', '4355', '4356', '4360', '4361', '4362', '4365', '4366', '4367', '4368', '4369', '4370', '4371', '4372', '4373', '4374', '4375', '4376', '4377', '4378', '4379', '4380', '4381', '4382', '4384', '4385', '4386', '4387', '4388', '4389', '4390', '4391', '4392', '4393', '4394', '4395', '4396', '4397', '4398', '4401', '4403', '4404', '4406', '4409', '4410', '4412', '4413', '4414', '4415', '4416', '4417', '4418', '4419', '4420', '4421', '4422', '4423', '4424', '4425', '4427', '4428', '4429', '4430', '4431', '4432', '4433', '4434', '4435', '4436', '4437', '4438', '4439', '4440', '4441', '4442', '4443', '4444', '4445', '4446', '4447', '4448', '4449', '4450', '4452', '4461', '4462', '4463', '4464', '4465', '4471', '4475', '4476', '4477', '4478', '4479', '4480', '4481', '4482', '4483', '4484', '4485', '4486', '4487', '4488', '4489', '4490', '4491', '4492', '4493', '4494', '4495', '4496', '4498', '4499', '4502', '4503', '4506', '4507', '4512', '4516', '4519', '4521', '4523', '4524', '4526', '4527', '4528', '4530', '4531', '4534', '4536',
                  '4538', '4539', '4540', '4543', '4544', '4547', '4548', '4549', '4551', '4552', '4553', '4554', '4556', '4558', '4559', '4563', '4564', '4565', '4568', '4569', '4570', '4571', '4572', '4574', '4575', '4576', '4577', '4578', '4579', '4581', '4582', '4583', '4584', '4586', '4587', '4588', '4591', '4592', '4593', '4594', '4595', '4596', '4597', '4598', '4599', '4611', '4612', '4613', '4615', '4616', '4617', '4619', '4620', '4621', '4623', '4624', '4625', '4626', '4627', '4628', '4629', '4631', '4633', '4634', '4635', '4636', '4641', '4642', '4644', '4645', '4650', '4651', '4657', '4658', '4659', '4661', '4662', '4664', '4665', '4666', '4667', '4668', '4671', '4673', '4674', '4676', '4678', '4679', '4680', '4681', '4684', '4685', '4686', '4687', '4689', '4690', '4691', '4694', '4704', '4705', '4707', '4708', '4709', '4712', '4714', '4716', '4718', '4719', '4720', '4722', '4725', '4726', '4728', '4732', '4733', '4735', '4736', '4739', '4743', '4745', '4746', '4748', '4750', '4751', '4752', '4754', '4755', '4760', '4761', '4762', '4763', '4765', '4766', '4767', '4768', '4769', '4770', '4771', '4772', '4776', '4777', '4781', '4783', '4784', '4792', '4800', '4801', '4809', '4812', '4813', '4814', '4816', '4819', '4820', '4824', '4825', '4826', '4828', '4829', '4832', '4833', '4837', '4838', '4839', '4840', '4845', '4847', '4848', '4849', '4880', '4881', '4882', '4883', '4884', '4885', '4886', '4887', '4888', '4889', '4890', '4891', '4892', '4901', '4902', '4911', '4912', '4914', '4917', '4918', '4919', '4920', '4921', '4922', '4923', '4925', '4926', '4927', '4928', '4929', '4930', '4931', '4932', '4933', '4934', '4935', '4936', '4937', '4951', '4955', '4956', '4957', '4958', '4960', '4963', '4966', '4967', '4968', '4970', '4971', '4972', '4973', '4974', '4975', '4976', '4977', '4978', '4979', '4980', '4985', '4987', '4990', '4992', '4994', '4996', '4997', '4998']

for code in stockCodesList:
    setStockPrice(code, period='10y')
